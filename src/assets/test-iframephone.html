<html>
<head>
  <title>Sage iFramePhone Test</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="build-info" content="__BUILD_INFO__" >
  <meta name="environment" content="__ENVIRONMENT__" >

  <script src="js/jsPlumb.js"></script>
  <script src="js/globals.js"></script>
  <script src="js/app.js"></script>
  <script src="js/iframe-phone.js"></script>

  <link rel="stylesheet" href="css/app.css">
  <link rel="stylesheet" href="codap-ivy-fonts.css">
</head>
<body>
  <div class="content-box">
    <div id='app'></div>
  </div>
  <script type="text/javascript" charset="utf-8">
    Sage.initApp(false);

    // IFrameEndpoint instance is a singleton (iframe can't have multiple parents anyway).
    var phone = iframePhone.getIFrameEndpoint();
    phone.addListener('initInteractive', function (content) {
      console.log("iframe received initInteractive message: " + content);
      phone.post('response', 'got it');
    });

    // Initialize connection after all message listeners are added!
    phone.initialize();

    // periodically send log and save messages
    const logData = () => {
      const logDataToSend = { test: "log data" };
      phone.post('log', logDataToSend);
      console.log("sent: " + JSON.stringify(logDataToSend));
    }
    const saveData = () => {
      const saveDataToSend = { test: "save data" };
      phone.post('log', saveDataToSend);
      console.log("sent: " + JSON.stringify(saveDataToSend));
    }

    setTimeout(logData, 2000);
    setTimeout(saveData, 4000);

  </script>
</body>
</html>
